{% extends "layout.html" %}

{% block title %}Employer Dashboard{% endblock %}

{% block content %}
<div style="display: flex; height: 100vh; gap: 10px; padding: 10px;">

    <div style="flex: 5; display: flex; flex-direction: column;">
        <h5 style="margin-bottom: 10px;">Positions</h5>

        <div style="margin-bottom: 10px;">
            <a href="{{ url_for('employer_views.create_position') }}" class="btn purple">
                Create Position
            </a>
        </div>

        <div style="margin-bottom: 10px;">
            <form method="GET" action="{{ url_for('employer_views.employer_dashboard') }}">
                <input type="text" name="q_positions" placeholder="Search positions..."
                       value="{{ q_positions }}"
                       style="width: 100%; padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
            </form>
        </div>

       
        <div style="border: 2px solid purple; border-radius: 8px; padding: 10px; display: flex; flex-direction: column; gap: 10px;">
            {% if positions %}
                {% for pos in positions %}
                    <div class="card hoverable" 
                         style="padding: 10px; cursor: pointer; position: relative;"
                         data-url="{{ url_for('employer_views.employer_dashboard', selected_position=pos.id) }}"
                         onclick="window.location=this.dataset.url">
                        <span class="card-title" style="font-weight: bold;">{{ pos.title }}</span>
                        <p><strong>Description:</strong> {{ pos.description }}</p>
                        <p><strong>Capacity:</strong> {{ pos.number_of_positions }}</p>
                        <p><strong>Status:</strong> {{ pos.status.value }}</p>

                        <a href="{{ url_for('employer_views.edit_position', position_id=pos.id) }}" 
                           class="btn btn-small purple"
                           style="position: absolute; top: 10px; right: 10px;"
                           onclick="event.stopPropagation();">
                            Edit Position
                        </a>
                    </div>
                {% endfor %}
            {% else %}
                <p>You have not created any internship positions.</p>
            {% endif %}
        </div>
    </div>

    <div style="flex: 5; display: flex; flex-direction: column;">
        <h5 style="margin-bottom: 10px;">Shortlisted Applications</h5>
        <div style="border: 2px solid purple; border-radius: 8px; padding: 10px; display: flex; flex-direction: column; gap: 10px;">
            {% if selected_position %}
                {% if shortlisted %}
                    {% for app in shortlisted %}
                        <div class="card hoverable" style="padding: 5px;">
                            <div class="card-content">
                                <span class="card-title" style="font-weight: bold;">{{ app.student.username }}</span>
                                <p>Status: {{ app.state_name|capitalize }}</p>
                                <a href="{{ url_for('employer_views.review_shortlist_application', 
                                            position_id=app.position_id, 
                                            application_id=app.id) }}"
                                    class="btn-small purple">
                                    Review
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>No shortlisted applicants found for this position.</p>
                {% endif %}
            {% else %}
                <p>Select a position from the left panel to view shortlisted applicants.</p>
            {% endif %}
        </div>
    </div>

</div>
{% endblock %}
